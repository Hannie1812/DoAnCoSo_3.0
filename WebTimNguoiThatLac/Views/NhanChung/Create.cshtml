@model WebTimNguoiThatLac.Models.NhanChung

@{
    ViewData["Title"] = "Gửi thông tin nhân chứng";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <!-- Hiển thị thông báo -->
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success">@TempData["SuccessMessage"]</div>
            }
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
            }

            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h2 class="h4 mb-0">Gửi Thông Tin Nhân Chứng</h2>
                </div>

                <div class="card-body">
                    <form asp-action="Create" method="post" enctype="multipart/form-data">
                        <input type="hidden" asp-for="TimNguoiId" />

                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <!-- Thông tin người mất tích -->
                        <h5 class="mb-3">Thông tin người mất tích</h5>
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <p><strong>Tên:</strong> @ViewBag.TenNguoiMatTich</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <p><strong>Khu vực:</strong> @ViewBag.KhuVucMatTich</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <p><strong>Ngày sinh:</strong> @ViewBag.NgaySinh</p>
                            </div>
                        </div>
                        <!-- Thông tin cá nhân -->
                        <h5 class="mb-3">Thông tin cá nhân</h5>
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label asp-for="HoTen" class="form-label fw-bold">Họ tên *</label>
                                <input asp-for="HoTen" class="form-control" required />
                                <span asp-validation-for="HoTen" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="Email" class="form-label fw-bold">Email *</label>
                                <input asp-for="Email" class="form-control" type="email" required />
                                <span asp-validation-for="Email" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="SoDienThoai" class="form-label fw-bold">Số điện thoại *</label>
                                <input asp-for="SoDienThoai" class="form-control" required />
                                <span asp-validation-for="SoDienThoai" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Thông tin nhìn thấy -->
                        <h5 class="mb-3">Thông tin nhìn thấy</h5>
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label asp-for="ThoiGian" class="form-label fw-bold">Thời gian nhìn thấy *</label>
                                <input asp-for="ThoiGian" type="datetime-local" class="form-control" required />
                                <span asp-validation-for="ThoiGian" class="text-danger small"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="DiaDiem" class="form-label fw-bold">Địa điểm nhìn thấy *</label>
                                <input asp-for="DiaDiem" class="form-control" required />
                                <span asp-validation-for="DiaDiem" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Mô tả chi tiết -->
                        <div class="mb-4">
                            <label asp-for="MoTaManhMoi" class="form-label fw-bold">Mô tả chi tiết *</label>
                            <textarea asp-for="MoTaManhMoi" class="form-control" rows="5" required></textarea>
                            <span asp-validation-for="MoTaManhMoi" class="text-danger small"></span>
                        </div>

                        <!-- File đính kèm -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Tệp đính kèm (nếu có)</label>
                            <input type="file" name="file" class="form-control" accept="image/*,video/*" />
                            <small class="text-muted">Chấp nhận ảnh (JPEG, PNG) hoặc video (MP4), tối đa 5MB</small>
                            <div id="filePreview" class="mt-2"></div>
                        </div>

                        <!-- Nút gửi -->
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-paper-plane me-2"></i> Gửi thông tin
                            </button>
                            <a href="@Url.Action("ChiTietBaiViet", "TimNguoi", new { id = Model.TimNguoiId })"
                               class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i> Quay lại
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Thông báo pháp lý -->
            <div class="mt-3 alert alert-info">
                <h6><i class="fas fa-info-circle me-2"></i>Lưu ý quan trọng</h6>
                <p class="mb-1">- Thông tin bạn cung cấp sẽ được bảo mật</p>
                <p class="mb-1">- Chỉ sử dụng cho mục đích tìm kiếm nhân đạo</p>
                <p class="mb-0">- Vui lòng cung cấp thông tin chính xác</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <script>
        $(document).ready(function() {
            // Xem trước file
            $("input[type='file']").change(function() {
                const file = this.files[0];
                const preview = $("#filePreview");

                preview.empty();

                if (file) {
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        if (file.type.startsWith("image/")) {
                            preview.html(`<img src="${e.target.result}" class="img-thumbnail" style="max-height:200px;">`);
                        } else if (file.type.startsWith("video/")) {
                            preview.html(`
                                <div class="alert alert-info">
                                    <i class="fas fa-video me-2"></i>
                                    Đã chọn video: ${file.name}
                                </div>
                            `);
                        }
                    };

                    reader.readAsDataURL(file);
                }
            });

            // Kiểm tra kích thước file
            $("form").submit(function() {
                const fileInput = $("input[type='file']")[0];
                if (fileInput.files.length > 0) {
                    const fileSize = fileInput.files[0].size / 1024 / 1024; // MB
                    if (fileSize > 5) {
                        alert("File đính kèm không được vượt quá 5MB");
                        return false;
                    }
                }
                return true;
            });
        });
    </script>
}